---
title: "leaflegend Recipes"
author: "Thomas Roh"
date: '2022-07-31'
slug: leaflegend-recipes
categories:
  - R
tags:
  - leaflet
  - leaflegend
  - R
format: 
  hugo:
    fig-height: 3
    toc: true
---

*Requires leaflegend >= 1.0.0*

#### Base Data and Map

```{r}
library(leaflet)
library(leaflegend)
mapData <- data.frame(x = c(2, 1, 5, 4,3) , y = c('A', 'B', 'C', 'B', 'A'), 
                      lng = -(118:122), lat = rep(42, 5))
map <- leaflet::leaflet(data = mapData, 
                        options = leafletOptions(zoomControl = FALSE))
```

```{r}
#| echo: false
save_widget_png <- function(widget = .Last.value, i, ...) {
  tmp <- tempfile("webshot", fileext = ".html")
  fileName <- sprintf('img/figure-%03d', i)
  htmlwidgets::saveWidget(widget, file = tmp)
  webshot2::webshot(url = tmp, file = , ...)
  cat(sprintf('![](%s)', fileName))
  unlink(tmp)
  i + 1
}
i <- 1
vwidth <- 800
vheight <- 278

```


## Color Scales

### Create Legend for a Continuous Scale

```{r}
#| output: false
numPal <- colorNumeric('inferno', mapData$x)
lgd <- 
  map |> addLegendNumeric(pal = numPal, values = ~x, decreasing = TRUE) |> 
  addLegendNumeric(pal = numPal, values = ~x, orientation = 'horizontal',
                   width = 120, height = 20, position = 'topright')
lgd
```


```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```


### Create Legend for Quantiles

```{r}
#| output: false
quantPal <- colorQuantile('Reds', mapData$x, n = 3)
lgd <- 
  map |> addLegendQuantile(pal = quantPal, values = ~x) |> 
    addLegendQuantile(pal = quantPal, values = ~x, numberFormat = NULL, 
                      position = 'topright')
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Create Legend for Bins & Change Legend Symbol

```{r}
#| output: false
binPal <- colorBin(c('grey', 'blue'), mapData$x, bins = 3, pretty = FALSE)
lgd <- 
  map |> addLegendBin(pal = binPal, shape = 'triangle')
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Create Legend for Factors & Re-order

```{r}
#| output: false
factorPal <- colorFactor('Dark2', domain = mapData$y)
reOrder <- c('C', 'A', 'B')
factorPalRev <- colorFactor('Dark2', domain = reOrder, ordered = TRUE)
lgd <- 
  map |> addLegendFactor(pal = factorPal, values = ~y) |> 
    addLegendFactor(pal = factorPalRev, 
                    values = ~factor(y, levels = reOrder), 
                    position = 'topright')
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

## Symbols & Size Scales

### Legend & Points with Size Encoding

```{r}
#| output: false
lgd <- 
  map |> addLegendSize(values = ~x, color = 'black', shape  = 'plus', 
                       breaks = 3) |> 
    addSymbolsSize(lng = ~lng, lat = ~lat, values = ~x, shape = 'plus', 
                   color = 'black')
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Legend & Points with Double Encoding

```{r}
#| output: false
lgd <- 
  map |> addLegendSize(values = ~x, shape  = 'plus', breaks = 3, pal = numPal,
                       color = 'black') |> 
    addSymbolsSize(lng = ~lng, lat = ~lat, values = ~x, shape = 'plus', 
                   color = 'black', fillColor = ~numPal(x))
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Legend & Points with Size & Color Encoding

```{r}
#| output: false
lgd <- 
  map |> addLegendSize(values = ~x, shape  = 'plus', breaks = 3, pal = numPal,
                       color = 'black', fillColor = 'transparent') |> 
    addSymbolsSize(lng = ~lng, lat = ~lat, values = ~x, shape = 'plus', 
                   color = 'black', fillColor = ~factorPal(y)) |> 
    addLegendFactor(pal = factorPal, values = ~y, position = 'topright')
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Legend & Points with Symbol Encoding

```{r}
#| output: false
lgd <- 
  map |> addSymbols(lng = ~lng, lat = ~lat, values = ~y, color = 'black') |> 
    addLegendSymbol(values = ~y, color = 'black')
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Legend & Points with Symbol Encoding (Non-Defaults)

```{r}
#| output: false
lgd <- 
  map |> addSymbols(lng = ~lng, lat = ~lat, values = ~y, 
                    fillColor = ~factorPal(y), color = 'black',
                    shape = c('cross', 'diamond', 'star')) |> 
    addLegendSymbol(values = ~y, pal = factorPal, 
                    shape = c('cross', 'diamond', 'star'), color = 'black')
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Legend for Line Size Encodings

```{r}
#| output: false
lgd <- 
  map |> addLegendLine(values = ~x, color = 'black', 
                       orientation = 'horizontal', width = 50)
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

## Images

### Add Custom Images to a Legend

```{r}
#| output: false
# use raster image
leafImg <- system.file('img/leaf-blue.png', package = 'leaflegend')
# use svg
circle <- makeSymbol('rect', fillColor = 'red', color = 'black', width = 20)
lgd <- 
  map |> 
    addLegendImage(images = list(leafImg, circle), labels = c('png', 'svg'),
                   height = 30, width = 20)
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Generate Map Symbols

```{r}
#| output: false
shapes <- c('rect', 'circle', 'triangle', 'plus', 'cross', 'star')
colors <- c('blue', 'red', 'yellow', 'green', 'orange', 'purple')
symbols <- Map(f = makeSymbol, shape = shapes, fillColor = colors, 
               color = 'black', opacity = 1, fillOpacity = .5, width = 20, 
               `stroke-width` = 2)
lgd <- 
  map |> addLegendImage(images = symbols, labels = shapes, 
                        orientation = 'horizontal')
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Add Awesome Marker Legend & Specify Icon as Text

```{r}
#| output: false
iconSet <- awesomeIconList(
  `Font Awesome` = makeAwesomeIcon(icon = "font-awesome", library = "fa",
                                   markerColor= 'red', iconColor = 'black'),
  Ionic = makeAwesomeIcon(icon='R', library = 'fa', 
                          text = fontawesome::fa("r-project"))
)
lgd <- 
  map |> addLegendAwesomeIcon(iconSet = iconSet)
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

## Customization

### Turn off Legend Background

```{r}
#| output: false
lgd <- 
  map |> addLegendFactor(values = ~y, pal = factorPal, 
                         class = 'leaflet-control', 
                         labelStyle = 'color: black;')
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Add Titles with Styling

```{r}
#| output: false
lgd <- 
  map |> addLegendFactor(values = ~y, pal = factorPal, 
                         title = htmltools::tags$div('Red Title', 
                                                     style = 'color:red;'))
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Change Label Styling

```{r}
#| output: false
lgd <- 
  map |> addLegendFactor(values = ~y, pal = factorPal, 
                         labelStyle = 'color: blue; font-size: 10px;')
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Symbol Styling

```{r}
#| output: false
lgd <- 
  map |> addLegendFactor(values = ~y, pal = factorPal, shape = 'polygon',
                         fillOpacity = .5, width = 20, height = 20)
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Make Symbol Icons

```{r}
#| output: false
symbolSet <- makeSymbolIcons(shape = c('rect', 'circle', 'triangle'), 
                             width = 10, color = 'grey', opacity = 1)
lgd <- 
  map |> addMarkers(lng = ~lng, lat = ~lat, icon = ~symbolSet[as.factor(y)])
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Make Symbols with Size Encodings

```{r}
#| output: false
lgd <- 
  map |> addMarkers(lng = ~lng, lat = ~lat, 
                    icon = ~makeSymbolsSize(x, color = 'black', 
                                            fillColor = 'black',
                                            baseSize = 20, 
                                            fillOpacity = .5))
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

### Legends with Overlay Controls

```{r}
#| output: false
lgd <- 
  map |> addLegendFactor(values = ~y, pal = factorPal, group = 'Legend') |> 
    addLayersControl(overlayGroups = 'Legend', 
                     options = layersControlOptions(collapsed = FALSE))
lgd
```

```{r, results='asis'}
#| echo: false
i <- save_widget_png(lgd, i = i, vwidth = vwidth, vheight = vheight)
```

